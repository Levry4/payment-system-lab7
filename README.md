Лабораторная работа 7: Архитектура, слои и DDD-lite

Описание проекта

Реализация системы оплаты заказа с использованием слоистой архитектуры и принципов DDD-lite. Проект демонстрирует разделение ответственности между слоями, применение Dependency Inversion Principle и реализацию доменных инвариантов.

Структура проекта

text
payment-system-lab7/
├── domain/                    # Доменный слой
│   ├── __init__.py
│   ├── entities.py           # Доменные сущности
│   └── value_objects.py      # Value Objects
├── application/              # Слой приложения
│   ├── __init__.py
│   └── use_cases.py          # Use Cases и интерфейсы
├── infrastructure/           # Инфраструктурный слой
│   ├── __init__.py
│   ├── repositories.py       # Реализации репозиториев
│   └── gateways.py          # Реализации платежных шлюзов
├── tests/                    # Модульные тесты
│   ├── __init__.py
│   └── test_use_cases.py     # Тесты use-case и доменных инвариантов
├── main.py                   # Точка входа с демонстрацией
├── requirements.txt          # Зависимости
└── README.md                 # Документация
Доменный слой (Domain Layer)

Сущности и Value Objects

Order - корневая сущность, агрегат заказа
OrderLine - часть агрегата Order, представляет строку заказа
Money - Value Object для денежных сумм (неизменяемый)
OrderStatus - перечисление статусов заказа (CREATED, PAID, CANCELLED)
InvalidOrderOperation - исключение для недопустимых операций
Доменные инварианты

Нельзя оплатить пустой заказ - проверка наличия строк заказа перед оплатой
Нельзя оплатить заказ повторно - проверка текущего статуса заказа
После оплаты нельзя менять строки заказа - блокировка изменений в оплаченном заказе
Итоговая сумма равна сумме строк - автоматический расчет общей суммы
Слой приложения (Application Layer)

Use Cases

PayOrderUseCase - основной сценарий оплаты заказа:

Загружает заказ через OrderRepository
Выполняет доменную операцию оплаты
Вызывает платеж через PaymentGateway
Сохраняет обновленный заказ
Возвращает результат операции
Интерфейсы

OrderRepository - интерфейс для работы с хранилищем заказов
PaymentGateway - интерфейс для взаимодействия с платежными системами
PayOrderResult - DTO для возврата результата операции оплаты
Инфраструктурный слой (Infrastructure Layer)

Реализации

InMemoryOrderRepository - реализация репозитория на основе in-memory хранилища
FakePaymentGateway - фейковая реализация платежного шлюза для тестирования
Запуск проекта

Установка зависимостей

bash
pip install -r requirements.txt
Запуск демонстрации

bash
python main.py
Запуск тестов

bash
python -m pytest tests/ -v
или

bash
python -m unittest discover tests/
